#!/usr/bin/env bash
set -euo pipefail

# if [[ $1 =~ "[a-zA-Z0-9]{1,}\.[a-zA-Z0-9]{1,}" ]] ; then # /f/d/*.py
#     echo "wildcard"
# fi
#
# if [[ $1 =~ "*[.]*$" ]] ; then # /f/d/x.py
#     echo "file"
# fi

# inotifywait -qrm --event modify,create,delete,move --format "%w%f"

while true; do
    gonow=
    stat=$(stat --format=%Y.%Z.%s $1)

    if [ "$stat" != "${laststat:-$stat}" ]; then
        laststat=$stat
        gonow=yes
    fi

    if [ -n "$gonow" ]; then
        echo "[[=== start ===]]"
        $@
        echo "[[=== done ===]]"
    fi

    laststat=$stat
    sleep 1
done
