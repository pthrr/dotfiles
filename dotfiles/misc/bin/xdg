#!/usr/bin/env bash
set -euo pipefail

case "${@: -1}" in
*://* | *.html)
	exec $BROWSER "$@"
	;;
*.pdf | *.djvu | *.ps)
	exec $PDFVIEWER "$@"
	;;
*.jpg | *.jpeg | *.png | *.gif | *.bmp | *.webp | *.svg)
	exec $IMAGEVIEWER "$@"
	;;
*.mp3 | *.mp4 | *.mkv | *.avi | *.mov | *.webm | *.flv | *.wmv | *.m4v | *.mpg | *.mpeg | *.wav | *.flac | *.ogg | *.m4a | *.aac)
	exec $MEDIAPLAYER "$@"
	;;
*.zip | *.tar.gz | *.tgz | *.tar.bz2 | *.tbz2 | *.tar.xz | *.txz | *.tar.zst | *.tar | *.rar | *.7z)
	archive="${@: -1}"
	archive="$(realpath "$archive")"
	archive_dir="$(dirname "$archive")"
	archive_name="$(basename "$archive")"

	# Remove all archive extensions to get folder name
	folder_name="$archive_name"
	folder_name="${folder_name%.tar.gz}"
	folder_name="${folder_name%.tar.bz2}"
	folder_name="${folder_name%.tar.xz}"
	folder_name="${folder_name%.tar.zst}"
	folder_name="${folder_name%.tgz}"
	folder_name="${folder_name%.tbz2}"
	folder_name="${folder_name%.txz}"
	folder_name="${folder_name%.tar}"
	folder_name="${folder_name%.zip}"
	folder_name="${folder_name%.rar}"
	folder_name="${folder_name%.7z}"

	target_dir="$archive_dir/$folder_name"
	mkdir -p "$target_dir"
	cd "$target_dir"
	exec extract "$archive"
	;;
*)
	if [ -d "${@: -1}" ]; then
		exec $FILEMANAGER "$@"
	else
		xdg-open "$@"
	fi
	;;
esac
