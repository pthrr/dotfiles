#!/usr/bin/env bash
set -euo pipefail

S3_HOST="${SCCACHE_S3_HOST:-nwv-srv}"
S3_PORT="${SCCACHE_S3_PORT:-8333}"

if timeout 2 bash -c "</dev/tcp/${S3_HOST}/${S3_PORT}" 2>/dev/null; then
    export SCCACHE_BUCKET=sccache
    export SCCACHE_ENDPOINT="http://${S3_HOST}:${S3_PORT}"
    export SCCACHE_REGION=us-east-1
    export AWS_ACCESS_KEY_ID=sccache
    export AWS_SECRET_ACCESS_KEY=sccache
else
    export SCCACHE_DIR="$HOME/.cache/sccache"
    export SCCACHE_CACHE_SIZE="10G"
fi

sccache "$@"
