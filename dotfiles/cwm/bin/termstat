#!/usr/bin/env bash
#set -eu -o pipefail

BAR_FIFO=/tmp/bar_fifo
DELIM=" - "

if [ ! -e "${BAR_FIFO}" ] ; then
    mkfifo ${BAR_FIFO}
fi

mem()
{
    MEM=$(free | grep "Speicher" | awk '{ printf "%.0f%", $3/$2 * 100.0 }')
}

temp()
{
    TEMP=$(sensors | grep "Package" | awk '{ print $4 }')
}

disk()
{
    DISK=$(stat -fc '%f * %s / 1000^3' / | bc | awk '{ printf "%dG", $1 }')
}

bat()
{
    BAT=""
}

while : ; do
    mem
    temp
    disk
    bat
    echo -e "STAT|MEM ${MEM}${DELIM}CPU ${TEMP}${DELIM}SSD ${DISK}${DELIM}BAT ${BAT}"
    sleep 1
done > ${BAR_FIFO}
