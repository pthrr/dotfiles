#!/usr/bin/env bash
#set -eu -o pipefail

BAR_FIFO=/tmp/bar_fifo
DELIM=" | "

if [ ! -e "${BAR_FIFO}" ] ; then
    mkfifo ${BAR_FIFO}
    sleep 1
fi

termprop &
termdate &
termstat &

cat "${BAR_FIFO}" | while read -r line ; do
    IFS='|' read -r -a list <<< "${line}"

    case ${list[0]} in
        PROP)
            groups=${list[1]}
            ;;
        DATE)
            time=${list[1]}
            ;;
        STAT)
            stats=${list[1]}
            ;;
    esac

    output="${groups}${DELIM}${time}${DELIM}${stats}"
    printf "%s\n" "${output}"
done
